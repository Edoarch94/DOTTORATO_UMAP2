<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Epigrafe Claudia Nova – embed</title>

<!-- model-viewer -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
  :root{
    --bg:#111;
    --card:#181818;
    --accent:#2563eb;
  }
  html,body{
    margin:0;
    padding:0;
    background:transparent;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:#eee;
  }

  .shell{
    width:100%;
    max-width:680px;
    margin:0 auto;
    background:#000;
    border-radius:14px;
    overflow:hidden;
    box-shadow:0 6px 20px rgba(0,0,0,.45);
  }

  .topbar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:8px 12px;
    background:rgba(0,0,0,.85);
  }
  .topbar-title{
    font-size:14px;
    font-weight:600;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    padding-right:8px;
  }
  .full-btn{
    border-radius:999px;
    padding:6px 14px;
    font-size:12px;
    border:1px solid rgba(255,255,255,.35);
    background:rgba(24,24,24,.95);
    color:#fff;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    gap:6px;
    cursor:pointer;
  }
  .full-btn::before{
    content:"\1F5A5"; /* icona monitor semplice */
    font-size:14px;
  }

  model-viewer{
    display:block;
    width:100%;
    height: min(360px, 55vh); /* più compatto per u-map */
    background:#050505;
  }

  /* pannello comandi compatto */
  .controls{
    padding:8px 10px 10px;
    background:#111;
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .ctrl-group{
    background:#181818;
    border-radius:10px;
    padding:8px 10px;
    font-size:12px;
  }
  .ctrl-label{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:4px;
    font-weight:500;
  }
  .row{
    display:flex;
    align-items:center;
    gap:8px;
  }

  /* toggle orbit */
  .toggle{
    position:relative;
    width:46px;
    height:24px;
    border-radius:999px;
    background:#262626;
    cursor:pointer;
    flex:0 0 auto;
  }
  .toggle-knob{
    position:absolute;
    top:2px; left:2px;
    width:20px; height:20px;
    border-radius:50%;
    background:#fff;
    transition:.18s ease;
  }
  .toggle.on{ background:#16a34a; }
  .toggle.on .toggle-knob{ transform:translateX(22px); }
  .toggle-label{
    font-size:12px;
  }

  /* slider stile “progredisce” */
  .slider{
    flex:1;
    -webkit-appearance:none;
    appearance:none;
    height:6px;
    border-radius:999px;
    background:linear-gradient(to right,var(--accent) 0,var(--accent) 0,#e5e5e5 0,#e5e5e5 100%);
    background-repeat:no-repeat;
    outline:none;
  }
  .slider::-webkit-slider-thumb{
    -webkit-appearance:none;
    appearance:none;
    width:18px;height:18px;
    border-radius:50%;
    background:#fff;
    border:2px solid var(--accent);
    margin-top:-6px;
  }
  .slider::-moz-range-thumb{
    width:18px;height:18px;
    border-radius:50%;
    background:#fff;
    border:2px solid var(--accent);
  }

  .value{
    font-size:12px;
    min-width:48px;
    text-align:right;
    opacity:.85;
  }

  /* bottone VR iconico */
  .vr-btn{
    width:40px;
    height:40px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.35);
    background:#181818;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    flex:0 0 auto;
  }
  .vr-btn.disabled{
    opacity:.45;
    cursor:default;
    pointer-events:none;
  }
  .vr-icon{
    position:relative;
    width:22px;
    height:14px;
    border-radius:6px;
    border:1.6px solid #fff;
  }
  .vr-icon::before, .vr-icon::after{
    content:"";
    position:absolute;
    border-radius:999px;
    border:1.4px solid #fff;
    border-top:none;
    border-left:none;
    border-right:none;
  }
  .vr-icon::before{
    left:-8px; right:-8px; bottom:-6px;
  }
  .vr-icon::after{
    right:-4px; bottom:-10px;
    height:22px;
    border-left:1.4px solid #fff;
    border-right:none;
    border-top:none;
  }
  .vr-text{
    font-size:11px;
    margin-left:4px;
  }

  @media (max-width:520px){
    .topbar{padding:6px 8px;}
    .full-btn{padding:5px 10px;font-size:11px;}
    model-viewer{height:280px;}
  }
</style>
</head>
<body>
<div class="shell">
  <div class="topbar">
    <div class="topbar-title">Epigrafe Claudia Nova</div>
    <a class="full-btn" href="epigrafe-three.html" target="_blank" rel="noopener">
      Viewer completo
    </a>
  </div>

  <model-viewer id="mv"
    src="https://edoarch94.github.io/DOTTORATO_UMAP2/modelli/Epigrafe.glb?v=9"
    camera-controls
    auto-rotate
    auto-rotate-delay="0"
    auto-rotate-speed="80deg/s"
    environment-image="https://modelviewer.dev/shared-assets/environments/neutral.hdr"
    exposure="2.4"
    shadow-intensity="0.6"
    ar
    ar-modes="webxr"
    xr-environment
    touch-action="pan-y"
    interaction-prompt="none">
    <!-- teniamo nascosto il bottone AR interno -->
    <button slot="ar-button" id="mvArBtn" style="display:none"></button>
  </model-viewer>

  <div class="controls">
    <!-- ORBIT -->
    <div class="ctrl-group">
      <div class="ctrl-label">
        <span>Orbit (auto-rotate)</span>
      </div>
      <div class="row">
        <div id="orbitToggle" class="toggle on">
          <div class="toggle-knob"></div>
        </div>
        <span class="toggle-label">Velocità</span>
        <input id="orbitSpeed" class="slider" type="range"
               min="0" max="3" step="0.05" value="1.2">
        <span id="orbitVal" class="value">1.2°/s</span>
      </div>
    </div>

    <!-- LUMINOSITÀ + VR -->
    <div class="ctrl-group">
      <div class="ctrl-label">
        <span>Luminosità</span>
      </div>
      <div class="row">
        <input id="expo" class="slider" type="range"
               min="1.6" max="3.2" step="0.05" value="2.4">
        <div class="value" id="expoVal">2.4</div>

        <button id="vrBtn" class="vr-btn" type="button" aria-label="VR">
          <div class="vr-icon"></div>
          <span class="vr-text">VR</span>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
const mv        = document.getElementById('mv');
const orbitTgl  = document.getElementById('orbitToggle');
const orbitSpeed= document.getElementById('orbitSpeed');
const orbitVal  = document.getElementById('orbitVal');
const expo      = document.getElementById('expo');
const expoVal   = document.getElementById('expoVal');
const vrBtn     = document.getElementById('vrBtn');

/* === helper per slider colorato === */
function updateSlider(slider){
  const min = +slider.min, max=+slider.max, val=+slider.value;
  const pct = (val-min)/(max-min)*100;
  slider.style.backgroundSize = pct+'% 100%';
}
[orbitSpeed, expo].forEach(s=>{
  updateSlider(s);
  s.addEventListener('input', ()=>updateSlider(s));
});

/* === Orbit auto-rotate === */
function applyOrbit(){
  const v = +orbitSpeed.value;
  orbitVal.textContent = v.toFixed(1)+'°/s';
  mv.autoRotate = !orbitTgl.classList.contains('off');
  if(mv.autoRotate){
    mv.autoRotateSpeed = v + 'deg/s';
  }
}
orbitTgl.addEventListener('click', ()=>{
  orbitTgl.classList.toggle('on');
  orbitTgl.classList.toggle('off');
  mv.autoRotate = orbitTgl.classList.contains('on');
  applyOrbit();
});
orbitSpeed.addEventListener('input', applyOrbit);

/* orbit ON di default */
mv.addEventListener('load', applyOrbit);

/* === Luminosità === */
expo.addEventListener('input', ()=>{
  mv.exposure = +expo.value;
  expoVal.textContent = (+expo.value).toFixed(1);
});

/* === VR: niente pagina nuova, chiama direttamente WebXR/AR su mobile === */
const isMobile = /android|iphone|ipad|ipod/i.test(navigator.userAgent);

if(!isMobile){
  // desktop: solo icona grigia non cliccabile
  vrBtn.classList.add('disabled');
}else{
  vrBtn.addEventListener('click', async ()=>{
    try{
      // model-viewer gestisce internamente WebXR / Scene Viewer
      await mv.activateAR();
    }catch(err){
      console.error('VR/AR non disponibile:', err);
    }
  });
}
</script>
</body>
</html>
